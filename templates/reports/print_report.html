<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Imprimir Relatório de Viagem {{ data.viagem_display }}</title>
    <style>
        @page {
            margin: 1.5cm;
            size: A4;
        }
        body {
            font-family: Arial, sans-serif;
            font-size: 9pt;
        }
        .report-print-container h2 {
            font-size: 16pt;
            text-align: center;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .print-section {
            page-break-inside: avoid;
        }
        .page-breaker {
            page-break-before: always;
        }
        .section-title, h4 {
            font-size: 11pt;
            font-weight: bold;
            padding: 5px;
            margin-top: 15px;
            margin-bottom: 5px;
            background-color: #e9ecef;
            border: 1px solid #dee2e6;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 5px 8px;
            text-align: left;
        }
        thead {
            background-color: #f2f2f2;
        }
        .text-end { text-align: right; }
        .no-print { display: none; }

        /* Força a impressão das cores de fundo e de texto */
        h4, .section-title, thead, .table-warning, .table-danger, .text-success, .text-danger {
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .table-warning { background-color: #fff3cd; }
        .table-danger { background-color: #f8d7da; }
        .text-success { color: #155724; }
        .text-danger { color: #721c24; }
    </style>
</head>
<body onload="window.print();">

    <div class="report-print-container">
        <div class="text-center mb-3"><h2>Relatório de Viagem</h2></div>

        <div class="print-section">
            <table class="table table-bordered table-sm">
                <tr>
                    <th style="width: 25%;">Viagem (CT-e)</th><td style="width: 25%;">{{ data.viagem_display }}</td>
                    <th style="width: 25%;">Data Viagem</th><td style="width: 25%;">{{ data.data_viagem | format_date }}</td>
                </tr>
                <tr>
                    <th>Veículo</th><td>{{ data.placa_veiculo or 'N/A' }}</td>
                    <th>Motorista</th><td>{{ data.motorista or 'N/A' }}</td>
                </tr>
            </table>
        </div>
        
        <div class="print-section">
            <h4 class="mt-4">Resultado da Viagem</h4>
            <table class="table table-bordered table-sm">
                <tr><td>Frete Bruto Recebido</td><td class="text-end">{{ data.frete_bruto | currency }}</td></tr>
                <tr><td>(-) Total Outros Custos</td><td class="text-end">{{ data.total_outros_custos | currency }}</td></tr>
                <tr style="font-weight: bold;">
                    <td>LUCRO/PREJUÍZO</td>
                    <td class="text-end {{ 'text-success' if data.lucro_prejuizo_valor >= 0 else 'text-danger' }}">{{ data.lucro_prejuizo_valor | currency }}</td>
                </tr>
                <tr style="font-weight: bold;">
                    <td>MARGEM (%)</td>
                    <td class="text-end {{ 'text-success' if data.margem_valor >= 0 else 'text-danger' }}">{{ data.margem_valor | percentage }}</td>
                </tr>
            </table>
        </div>

        <div class="page-breaker"></div>

        <div class="print-section">
            <h4 class="mt-4">Outros Custos da Viagem</h4>
            <table class="table table-bordered table-sm">
                <thead class="table-secondary">
                    <tr><th>Grupo</th><th>Data</th><th>Fornecedor</th><th>Descrição</th><th class="text-end">Valor</th></tr>
                </thead>
                <tbody>
                    {% for item in data.custos_detalhados %}
                    <tr>
                        <td>{{ item.descGrupoD or '' }}</td>
                        <td>{{ item.dataControle or '' }}</td>
                        <td>{{ item.nomeForn or '' }}</td>
                        <td>{{ item.descItemD or '' }}</td>
                        <td class="text-end">{{ item.valor_calculado | currency }}</td>
                    </tr>
                    {% else %}
                    <tr><td colspan="5" class="text-center">Nenhum custo encontrado.</td></tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr class="table-warning" style="font-weight: bold;">
                        <td colspan="4" class="text-end">TOTAL CUSTOS</td>
                        <td class="text-end">{{ data.total_custos | currency }}</td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

</body>
</html>